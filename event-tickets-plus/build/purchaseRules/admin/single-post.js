(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var l in s)e.o(s,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:s[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.element,l=window.wp.domReady;var a=e.n(l);const n=window.wp.hooks,i=window.wp.i18n,c=window.wp.components,r=window.wp.primitives,u=window.ReactJSXRuntime,o=(0,u.jsx)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(r.Path,{d:"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z"})}),d=(0,u.jsx)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(r.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),p=window.wp.apiFetch;var h=e.n(p);const w=window.wp.url,m=new Map;var v,_;function k(){return k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var l in s)({}).hasOwnProperty.call(s,l)&&(e[l]=s[l])}return e},k.apply(null,arguments)}const b=e=>t.createElement("svg",k({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"},e),v||(v=t.createElement("path",{fill:"currentColor",d:"M8.723 7.358a.51.51 0 0 1-.388-.176l-1.43-1.665a.516.516 0 0 1 .052-.722.516.516 0 0 1 .722.053l1.038 1.214L13.455.514a.512.512 0 1 1 .78.663L9.11 7.182a.51.51 0 0 1-.387.176"})),_||(_=t.createElement("path",{fill:"currentColor",d:"M14.259 5.247a.51.51 0 0 0-.616.387l-.75 3.26H4.98l-1.149-4.01a.54.54 0 0 0-.299-.329L1.24 3.617a.51.51 0 0 0-.669.281.51.51 0 0 0 .276.669l2.064.844 2.047 7.114c.065.223.264.37.493.37h7.195a.517.517 0 0 0 0-1.033H5.838L5.28 9.915h8.016c.24 0 .446-.164.498-.399l.845-3.659a.503.503 0 0 0-.381-.61M6.078 15.132a.733.733 0 1 1 0-1.466.733.733 0 0 1 0 1.466M12.182 15.132a.733.733 0 1 1 0-1.467.733.733 0 0 1 0 1.467"}))),x=window.jQuery;var g=e.n(x);const j=({addRules:e,allRules:l})=>{const[a,n]=(0,s.useState)(null),[r,d]=(0,s.useState)(!1),p=()=>d(!1),[v,_]=(0,s.useState)(!0),[k,x]=(0,s.useState)(!1),[g,j]=(0,s.useState)(""),[f,y]=(0,s.useState)(""),[R,S]=(0,s.useState)([]),[C,P]=(0,s.useState)([]),N=async()=>{n(null),_(!0),x(!0);try{const e=await(async(e,t)=>{const s=`${e=e||"any"}-${t=t||""}`;if(m.has(s)){const e=m.get(s);if(!Array.isArray(e))throw e;return e}try{const l={type:e,search:t,page:1,per_page:50,status:"active"},a=await h()({path:(0,w.addQueryArgs)("/tec/v1/purchase-rules/",l),method:"GET"});return m.set(s,a),a}catch(e){throw m.set(s,e),e}})(g,f),t=e.filter((e=>{return t=e.id,!l.some((e=>e.id===t));var t}));P(t),x(!1),S([])}catch(e){x(!1),P([]),n(e?.message||e?.error||(0,i.__)("An unknown error occurred while searching for rules.","event-tickets-plus"))}},A=[{label:(0,i.__)("Filter by type","event-tickets-plus"),value:""},...(H=(window?.tec?.ticketsPlus?.commerce?.purchaseRules?.singlePost?.data).types,Object.keys(H).map((e=>({label:H[e],value:e}))))];var H;return(0,s.useEffect)((()=>{(async()=>{await N()})()}),[]),(0,u.jsxs)(t.Fragment,{children:[(0,u.jsx)(c.Button,{variant:"link",className:"tec-tickets-plus-panel_purchase-rules__link",icon:o,iconPosition:"left",onClick:()=>d(!0),children:l.length>0?(0,i.__)("Add another rule","event-tickets-plus"):(0,i.__)("Add a rule","event-tickets-plus")}),r&&(0,u.jsxs)(c.Modal,{className:"tec-tickets-plus-purchase-rules-modal",size:"large",title:(0,i.__)("Add Purchase Rules","event-tickets-plus"),icon:(0,u.jsx)(b,{}),onRequestClose:p,children:[(0,u.jsxs)("div",{className:"tec-tickets-plus-purchase-rules-modal__3-column-grid",children:[(0,u.jsx)(c.SelectControl,{label:(0,i.__)("Rule Type","event-tickets-plus"),hideLabelFromVision:!0,value:g,onChange:e=>j(e),options:A}),(0,u.jsx)(c.TextControl,{label:(0,i.__)("Rule Name","event-tickets-plus"),hideLabelFromVision:!0,value:f,onChange:e=>y(e),placeholder:(0,i.__)("Search by rule name","event-tickets-plus")}),(0,u.jsx)(c.Button,{isBusy:k,variant:"secondary",onClick:N,children:(0,i.__)("Search","event-tickets-plus")})]}),(0,u.jsxs)("div",{className:"tec-tickets-plus-purchase-rules-modal__results "+(k?"tec-tickets-plus-purchase-rules-modal__results--is-loading":""),children:[k?(0,u.jsx)(c.Spinner,{style:{height:"calc(4px * 20)",width:"calc(4px * 20)"}}):null,k?null:C.length>0?C.map((e=>(0,u.jsx)(c.CheckboxControl,{checked:R.includes(e.id),label:e.name,onChange:t=>{((e,t)=>{S(t?[...R,e]:R.filter((t=>t!==e))),_(!1)})(e.id,t)}},e.id))):a?(0,u.jsx)(c.Notice,{className:"tec-tickets-plus-purchase-rules-panel__notice",status:"error",isDismissible:!1,children:a}):(0,u.jsx)("p",{children:(0,i.__)("No rules to add matching the search criteria.","event-tickets-plus")})]}),(0,u.jsxs)("div",{className:"tec-tickets-plus-purchase-rules-modal__actions",children:[(0,u.jsx)("button",{disabled:v||k||0===R.length,className:"button button-primary",onClick:()=>{const t=R.map((e=>C.find((t=>t.id===e))));e(t),P([...C.filter((e=>!R.includes(e.id)))]),S([]),_(!0),p()},children:(0,i.__)("Add","event-tickets-plus")}),(0,u.jsx)("button",{disabled:k,className:"button button-secondary",onClick:p,children:(0,i.__)("Cancel","event-tickets-plus")})]})]})]})},f=({onCancel:e,initialState:t,afterSave:l})=>{const{auto:a=[],manual:n=[]}=t,[r,o]=(0,s.useState)(null),[p,w]=(0,s.useState)(!0),[m,v]=(0,s.useState)(a),[_,k]=(0,s.useState)(n);return(0,u.jsxs)("div",{children:[r?(0,u.jsx)(c.Notice,{onRemove:()=>o(null),className:"tec-tickets-plus-purchase-rules-panel__notice",status:"error",isDismissible:!0,children:r}):null,(0,u.jsx)("h4",{children:(0,i.__)("Purchase Rules","event-tickets-plus")}),(0,u.jsxs)("div",{children:[m.length>0?(0,u.jsx)("p",{className:"tec-tickets-plus-purchase-rules-panel__description--auto",children:(0,i.__)("Rules are automatically applied to events based on rule scope. Uncheck a rule to disable it for this event.","event-tickets-plus")}):null,m.map((e=>(0,u.jsx)(c.CheckboxControl,{checked:e.enabled,label:e.name,onChange:t=>((e,t)=>{v([...m.map((s=>s.id===t?{...s,enabled:e}:s))]),w(!1)})(t,e.id)},e.id))),_.filter((e=>e.enabled)).length>0?(0,u.jsx)("p",{className:"tec-tickets-plus-purchase-rules-panel__description--manual",children:(0,i.__)("Manually added rules","event-tickets-plus")}):null,_.length>0?_.filter((e=>e.enabled)).map((e=>(0,u.jsxs)("p",{className:"tec-tickets-plus-purchase-rules-panel__rule--manual",children:[(0,u.jsx)(c.Button,{variant:"link",icon:d,label:(0,i.__)("Remove Rule","event-tickets-plus"),onClick:()=>{return t=e.id,k([..._.map((e=>e.id===t?{...e,enabled:!1}:e))]),void w(!1);var t}}),e.name]},e.id))):null,(0,u.jsx)(j,{addRules:e=>{k([..._,...e.map((e=>({...e,enabled:!0})))]),w(!1)},allRules:[...m,..._.length>0?_:[]]})]}),(0,u.jsx)("button",{disabled:p,className:"button button-primary",onClick:async()=>{o(null),w(!0);const e=[];for(const t of[...m,..._])e.push({rule_id:t.id,enabled:t.enabled});try{await h()({path:`/tec/v1/purchase-rules/posts/${g()("#post_ID").val()}`,method:"POST",data:{toggles:e}}),l({setIsDisabled:w})}catch(e){w(!1),o(e?.message||e?.error||(0,i.__)("An unknown error occurred.","event-tickets-plus"))}},children:(0,i.__)("Save Rules","event-tickets-plus")}),(0,u.jsx)("button",{className:"button button-secondary",onClick:e,children:(0,i.__)("Cancel","event-tickets-plus")})]})};a()((()=>{g()(document).on("click","#purchase_rules_form_toggle",(e=>(e.preventDefault(),window.tribe.tickets.editor.panels["purchase-rules"]="#tec-tickets-plus-panel_purchase-rules",window.tribe.tickets.editor.fetchPanels(null,"purchase-rules"),!1)));let e=null;(0,n.addAction)("tec.tickets.admin.panels.refreshed","tec.ticketsPlus.commerce.purchaseRules.admin.singlePost",(({swapTo:t})=>{if("purchase-rules"!==t)return;const l=document.getElementById("tec-tickets-plus-panel_purchase-rules-app");if(!l)return;const a=l.dataset.initialstate?JSON.parse(l.dataset.initialstate):{};null===e&&(e=(0,s.createRoot)(l)),e.render((0,u.jsx)(f,{onCancel:e=>(e.preventDefault(),window.tribe.tickets.editor.fetchPanels(null,"list"),!1),initialState:a,afterSave:({setIsDisabled:e})=>{window.tribe.tickets.editor.fetchPanels(null,"list")}}))}))})),window.ticketsPlus=window.ticketsPlus||{},window.ticketsPlus.purchaseRules=window.ticketsPlus.purchaseRules||{},window.ticketsPlus.purchaseRules.admin=window.ticketsPlus.purchaseRules.admin||{},window.ticketsPlus.purchaseRules.admin.singlePost={}})();