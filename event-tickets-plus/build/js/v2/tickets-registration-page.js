tribe.tickets=tribe.tickets||{},tribe.tickets.registration={},function(t,e){const i=t(document);e.selectors={container:".tribe-tickets__registration",eventContainer:".tribe-tickets__registration-event",form:"#tribe-tickets__registration-form",item:".tribe-tickets__tickets-item",itemPrice:".tribe-amount",itemQuantity:".tribe-ticket-quantity",itemTotal:".tribe-tickets__tickets-item-total .tribe-amount",footerQuantity:".tribe-tickets__tickets-footer-quantity-number",footerAmount:".tribe-tickets__tickets-footer-total .tribe-amount",checkoutButton:".tribe-tickets__registration-submit",metaForm:".tribe-tickets__registration-content",metaContainer:".tribe-tickets__attendee-tickets-container",metaContainerHasTickets:".tribe-tickets__attendee-tickets-container--has-tickets",metaItem:".tribe-tickets__attendee-tickets-item",miniCart:"#tribe-tickets__mini-cart"},e.commerceSelector={edd:"Tribe__Tickets_Plus__Commerce__EDD__Main",rsvp:"Tribe__Tickets__RSVP",tpp:"Tribe__Tickets__Commerce__PayPal__Main",Tribe__Tickets__Commerce__PayPal__Main:"tribe-commerce",Tribe__Tickets__RSVP:"rsvp",Tribe__Tickets_Plus__Commerce__EDD__Main:"edd",Tribe__Tickets_Plus__Commerce__WooCommerce__Main:"woo",tribe_eddticket:"edd",tribe_tpp_attendees:"tpp",tribe_wooticket:"woo",woo:"Tribe__Tickets_Plus__Commerce__WooCommerce__Main"},e.getTicketsForSave=function(){const i=[];let o=t(e.selectors.miniCart);return o.length||(o=t(e.selectors.container)),o.find(e.selectors.item).each((function(){const o=t(this),r=o.data("ticketId"),n=o.find(e.selectors.itemQuantity).text(),c={};c.ticket_id=r,c.quantity=n,i.push(c)})),i},e.initFormPreFills=function(o){const r=o.find(e.selectors.miniCart);tribe.tickets.loader.show(i),t.ajax({type:"GET",data:{provider:e.providerId},cache:!1,dataType:"json",url:tribe.tickets.utils.getRestEndpoint(),success(t){t.tickets&&e.preFillCartForm(r,t.tickets),t.meta&&(e.appendARFields(o,t),e.preFillMetaForm(o,t),window.dispatchEvent(new Event("tribe_et_after_form_prefills")))},complete(){tribe.tickets.loader.hide(i)}})},e.appendARFields=function(i,o){const r=o.tickets;let n=0,c=0;const s=i;t.each(r,(function(t,i){const o=window.wp.template("tribe-registration--"+i.ticket_id),r=s.find(e.selectors.metaContainer+'[data-ticket-id="'+i.ticket_id+'"]');r.length?c+=i.quantity:n+=i.quantity,r.addClass(e.selectors.metaContainerHasTickets.className());let a=0;for(let t=1;t<=i.quantity;++t){const e={attendee_id:t};try{r.append(o(window.wp.hooks.applyFilters("tec.tickets-plus.ticket-getTemplateData",e,i.ticket_id,a))),a++}catch(t){}}})),e.maybeShowNonMetaNotice(n,c)},e.maybeShowNonMetaNotice=function(e,i){const o=t(".tribe-tickets__notice--non-ar");0<e&&0<i?(t("#tribe-tickets__non-ar-count").text(e),o.removeClass("tribe-common-a11y-hidden")):o.addClass("tribe-common-a11y-hidden")},e.preFillMetaForm=function(i,o,r){let n=r;if(void 0===o||0>=o.length)return;void 0===n&&(n=0);const c=i.find(e.selectors.metaContainer);let s=o.meta;0<n&&(s=s.splice(0,n-1)),t.each(s,(function(i,o){const r=c.filter('[data-ticket-id="'+o.ticket_id+'"]'),n=t("<textarea />");if(!r.length)return;let s=0;t.each(o.items,(function(i,o){if("object"!=typeof o)return;const c=r.find(e.selectors.metaItem);t.each(o,(function(e,i){n.html(i);const o=n.text(),r=c.eq(s).find('[name*="'+e+'"]');r.is(":radio")||r.is(":checkbox")?r.each((function(){const e=t(this);o===e.val()&&e.prop("checked",!0)})):r.val(o),r.hasClass("tribe-tickets__form-field--birth-value")&&tribe.tickets.meta.populateFieldBirthday()})),s++}))}))},e.updateFooter=function(t){e.updateFooterCount(t),e.updateFooterAmount(t)},e.updateFooterCount=function(i){const o=i.find(e.selectors.footerQuantity);let r=0;i.find(e.selectors.itemQuantity).each((function(){let e=parseInt(t(this).text(),10);e=isNaN(e)?0:e,r+=e})),0>r||o.text(r)},e.updateFooterAmount=function(i){const o=i.find(e.selectors.footerAmount);let r=0;const n=i.find(e.selectors.itemQuantity),c=i.data("provider");n.each((function(){const i=t(this),o=i.closest(e.selectors.item);let n=parseInt(i.text(),10);n=isNaN(n)?0:n;const s=tribe.tickets.utils.getPrice(o,c),a=parseFloat(s)*n;r+=a})),0>r||o.text(tribe.tickets.utils.numberFormat(r,c))},e.preFillCartForm=function(i,o){const r=i.data("provider");t.each(o,(function(t,o){const n=i.find('[data-ticket-id="'+o.ticket_id+'"]');if(n){n.find(e.selectors.itemQuantity).html(o.quantity);const t=tribe.tickets.utils.getPrice(n,r),i=o.quantity*t,c=tribe.tickets.utils.numberFormat(i,r);n.find(e.selectors.itemTotal).html(c)}})),e.updateFooter(i)},e.bindSubmit=function(o){const r=o.find(e.selectors.checkoutButton),n=o.data("provider");r.on("click",(function(r){r.preventDefault();const c=o.find(e.selectors.metaForm),s=c.find(e.selectors.metaItem),a=o.find(".tribe-tickets__notice--error"),_=tribe.tickets.meta.validateForm(c);if(tribe.tickets.loader.show(i),!_[0])return t([document.documentElement,document.body]).animate({scrollTop:t(".tribe-tickets__registration").offset().top},"slow"),t(".tribe-tickets__notice--error__count").text(_[1]),a.show(),tribe.tickets.loader.hide(i),!1;a.hide();const d={tribe_tickets_provider:e.commerceSelector[n],tribe_tickets_tickets:e.getTicketsForSave(),tribe_tickets_meta:tribe.tickets.data.getMetaForSave(s)};t("#tribe_tickets_ar_data").val(JSON.stringify(d)),t(e.selectors.form).submit()}))},e.bindEvents=function(t){i.trigger("beforeSetup.tribeTicketsRegistrationPage",[t]),e.bindSubmit(t),i.trigger("afterSetup.tribeTicketsRegistrationPage",[t])},e.ready=function(){t(e.selectors.container).each((function(i,o){e.initFormPreFills(t(o)),e.bindEvents(t(o))}))},t(e.ready)}(jQuery,tribe.tickets.registration),window.ticketsPlus=window.ticketsPlus||{},window.ticketsPlus.v2=window.ticketsPlus.v2||{},window.ticketsPlus.v2.ticketsRegistrationPage={};