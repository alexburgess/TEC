tribe.tickets=tribe.tickets||{},tribe.dialogs=tribe.dialogs||{},tribe.dialogs.events=tribe.dialogs.events||{},tribe.tickets.modal={},function(t,e){const i=t(document);e.selectors={container:".tribe-modal__wrapper--ar",form:"#tribe-tickets__modal-form",cartForm:".tribe-modal__wrapper--ar #tribe-modal__cart",itemRemove:".tribe-tickets__tickets-item-remove",itemTotal:".tribe-tickets__tickets-item-total .tribe-amount",itemError:".tribe-tickets__attendee-tickets-item--has-error",attendeeItemRemove:".tribe-tickets__attendee-tickets-item-remove",metaForm:".tribe-modal__wrapper--ar #tribe-modal__attendee-registration",metaContainer:".tribe-tickets__attendee-tickets-container",metaContainerHasTickets:".tribe-tickets__attendee-tickets-container--has-tickets",metaItem:".tribe-tickets__attendee-tickets-item",submit:".tribe-tickets__attendee-tickets-submit",hidden:".tribe-common-a11y-hidden",validationNotice:".tribe-tickets__notice--error",ticketInCartNotice:"#tribe-tickets__notice__tickets-in-cart",noticeNonAr:".tribe-tickets__notice--non-ar",noticeNonArCount:".tribe-tickets__non-ar-count",noticeNonArSingular:".tribe-tickets__notice--non-ar-singular",noticeNonArPlural:".tribe-tickets__notice--non-ar-plural"},e.appendARFields=function(o){o.find(tribe.tickets.block.selectors.item).each((function(){const i=t(this);if(i.is(":visible")){const t=i.closest(tribe.tickets.block.selectors.item).data("ticket-id"),o=i.closest(e.selectors.form).find(e.selectors.metaContainer+'[data-ticket-id="'+t+'"]');if(!o.length)return;const c=o.find(e.selectors.metaItem),s=tribe.tickets.block.getQty(i);if(0>=s)return o.removeClass(e.selectors.metaContainerHasTickets.className()),void o.find(e.selectors.metaItem).remove();if(c.length>s){const t=c.length-s;o.find(e.selectors.metaItem+":nth-last-child( -n+"+t+" )").remove()}else if(c.length<s){const i=window.wp.template("tribe-registration--"+t),n=0<c.length?c.length+1:1;o.addClass(e.selectors.metaContainerHasTickets.className());let r=0;for(let a=n;a<=s;a++){const s={attendee_id:a};o.append(i(window.wp.hooks.applyFilters("tec.tickets-plus.ticket-getTemplateData",s,t,r))),r++,e.maybeHydrateAttendeeBlockFromLocal(c.length)}}}})),e.maybeShowNonMetaNotice(o),i.trigger("tribe-ar-fields-appended")},e.maybeShowNonMetaNotice=function(i){let o=0,c=0;const s=i.find(tribe.tickets.block.selectors.item).filter((function(){return t(this).find(tribe.tickets.block.selectors.itemQuantityInput).val()>0}));if(!s.length)return;s.each((function(){const i=t(this);if(!i.is(":visible"))return;const s=i.closest(tribe.tickets.block.selectors.item).data("ticket-id");t(e.selectors.metaForm).find(e.selectors.metaContainer+'[data-ticket-id="'+s+'"]').length?c+=tribe.tickets.block.getQty(i):o+=tribe.tickets.block.getQty(i)}));const n=t(e.selectors.noticeNonAr),r=t(e.selectors.noticeNonArSingular),a=t(e.selectors.noticeNonArPlural),l=t(".tribe-tickets__attendee-tickets-title");n.addClass(e.selectors.hidden.className()),0<o&&0<c?(n.find(e.selectors.noticeNonArCount).text(o),1<o?a.removeClass(e.selectors.hidden.className()):r.removeClass(e.selectors.hidden.className()),l.show()):l.hide()},e.preFillTicketsBlock=function(i){t.when(tribe.tickets.data.getData(!0)).then((function(t){const o=t.tickets;if(o.length){let t=0;o.forEach((function(e){const o=i.find(tribe.tickets.block.selectors.item+'[data-ticket-id="'+e.ticket_id+'"]');if("true"===o.attr("data-available")){const i=o.find(tribe.tickets.block.selectors.itemQuantityInput),c=o.find(tribe.tickets.block.selectors.itemOptOutInput+e.ticket_id+"--modal");i.length&&(i.val(e.quantity),i.trigger("change"),t+=e.quantity,1===parseInt(e.optout,10)&&c.prop("checked","true"))}})),0<t&&i.find(e.selectors.ticketInCartNotice).fadeIn()}}),(function(){const t=i.find(e.selectors.ticketInCartNotice);t.removeClass("tribe-tickets__notice--barred tribe-tickets__notice--barred-left").addClass(e.selectors.validationNotice.className()),t.find(".tribe-tickets-notice__title").text(TribeMessages.api_error_title),t.find(".tribe-tickets-notice__content").text(TribeMessages.connection_error),t.fadeIn()}))},e.preFillModalMetaForm=function(i){if(void 0===i||0>=i.length)return;const o=t(e.selectors.metaForm).find(e.selectors.metaContainer);t.each(i,(function(i,c){let s=0;const n=o.find(e.selectors.metaItem).filter('[data-ticket-id="'+c.ticket_id+'"]');n.length&&t.each(c.items,(function(e,i){"object"==typeof i&&(t.each(i,(function(e,i){const o=n.eq(s).find('[name*="'+e+'"]');o.is(":radio")||o.is(":checkbox")?o.each((function(){const e=t(this);i===e.val()&&e.prop("checked",!0)})):o.val(i)})),s++)}))}))},e.preFillModalCartForm=function(i){i.find(tribe.tickets.block.selectors.item).hide();const o=i.closest(tribe.tickets.block.selectors.container).find(tribe.tickets.block.selectors.item);t.each(o,(function(e,o){const c=t(o),s=i.find('[data-ticket-id="'+c.attr("data-ticket-id")+'"]');s&&0<c.find(tribe.tickets.block.selectors.itemQuantityInput).val()&&s.fadeIn()})),e.appendARFields(i)},e.initModalFormPreFills=function(i){const o=i.closest(tribe.tickets.block.selectors.container),c=i.data("post-id");tribe.tickets.loader.show(i),t.when(tribe.tickets.data.getData(!1,c)).then((function(c){const s=o.find(e.selectors.cartForm);e.preFillModalCartForm(s),c.meta&&t.each(c.meta,(function(t){o.find('[data-ticket-id="'+t.ticket_id+'"]').length&&e.preFillModalMetaForm(c.meta)}));const n=tribe.tickets.data.getLocal();n.meta&&e.preFillModalMetaForm(n.meta),window.setTimeout(tribe.tickets.loader.hide,500,i)})),tribe.tickets.loader.hide(i)},e.maybeHydrateAttendeeBlockFromLocal=function(i){t.when(tribe.tickets.data.getData()).then((function(o){if(!o.meta)return;const c=o.meta.length;if(i<c)return void e.preFillModalMetaForm(o.meta);const s=t(e.selectors.metaForm).find(e.selectors.metaItem).slice(i-1);s&&s.find(tribe.tickets.meta.selectors.formFieldInput).each((function(){const e=t(this),i=e.attr("name"),c=o[i];c&&e.val(c)}))}))},e.bindDocumentKeypress=function(){i.on("keypress",e.selectors.form,(function(i){if(13===i.keyCode){const o=t(i.target).closest(e.selectors.form);if("undefined"===o)return;i.preventDefault(),i.stopPropagation(),o.find('[name="cart-button"]').click()}}))},e.unbindModalFormClick=function(t){t.off("click",e.selectors.attendeeItemRemove)},e.bindModalFormClick=function(i){i.on("click",e.selectors.attendeeItemRemove,(function(){const i=t(this).closest(e.selectors.metaItem),o=i.closest(e.selectors.form),c=i.data("ticket-id"),s=o.find(e.selectors.metaContainer+'[data-ticket-id="'+c+'"]');if(i.is(":last-child"))i.remove();else{const o=s.find(e.selectors.metaItem);let n=!1;o.each((function(e,o){if(!n)return void(i.is(o)&&(n=!0,t(o).remove()));const s=t(o),r={attendee_id:e},a=window.wp.template("tribe-registration--"+c),l=t(a(r));l.insertBefore(s);const d=s.find("input, select");l.find("input, select").each((function(e,i){const o=t(d[e]);switch(t(i).attr("type")){case"radio":case"checkbox":t(i).prop("checked",o.prop("checked"));break;default:t(i).val(o.val())}})),s.remove()}))}s.find(e.selectors.metaItem).length||o.find(tribe.tickets.block.selectors.item+'[data-ticket-id="'+c+'"] '+e.selectors.itemRemove).trigger("click"),o.find(tribe.tickets.block.selectors.item+'[data-ticket-id="'+c+'"] '+tribe.tickets.block.selectors.itemQuantityRemove).trigger("click")}))},e.unbindModalSubmit=function(t){t.find(e.selectors.submit).off()},e.bindModalSubmit=function(o){const c=o.find(e.selectors.submit),s=o.data("post-id");c.on("click",(function(c){c.preventDefault();const n=t(this),r=t(e.selectors.form),a=t(e.selectors.metaForm),l=a.find(e.selectors.metaItem),d=tribe.tickets.meta.validateForm(a),k=t(e.selectors.validationNotice),b=n.attr("name"),m=r.data("provider");if(tribe.tickets.loader.show(r),!1===i.triggerHandler("isValidForm.eventTicketsModal",[r]))return tribe.tickets.loader.hide(r),!1;if(!d[0])return k.find(".tribe-tickets-notice__title").text(TribeMessages.validation_error_title),k.find("p").html(TribeMessages.validation_error),t(e.selectors.validationNotice+"__count").text(d[1]),k.show(),tribe.tickets.loader.hide(r),document.getElementById("tribe-tickets__notice-modal-attendee").scrollIntoView({behavior:"smooth",block:"start"}),!1;k.hide();let f=TribeTicketsURLs.checkout[m];-1!==b.indexOf("cart")&&(f=TribeTicketsURLs.cart[m]),t(e.selectors.form).attr("action",f);const u={tribe_tickets_provider:tribe.tickets.block.commerceSelector[m],tribe_tickets_tickets:tribe.tickets.block.getTicketsForCart(r),tribe_tickets_meta:tribe.tickets.data.getMetaForSave(l),tribe_tickets_post_id:s};o.find('[name="tribe_tickets_ar_data"]').val(JSON.stringify(u)),window.tribe.tickets.modal_redirect=!0,tribe.tickets.data.clearLocal(),r.submit()}))},e.unbindModalItemRemove=function(t){t.find(e.selectors.itemRemove).off()},e.bindModalItemRemove=function(i){i.find(e.selectors.itemRemove).on("click",(function(i){i.preventDefault();const o={},c=t(this).closest("form"),s=t(this).closest(tribe.tickets.block.selectors.item);s.find(tribe.tickets.block.selectors.itemQuantity).val(0),s.fadeOut(),o.id=s.data("ticketId"),o.qty=0,s.find(e.selectors.itemQuantityInput).val(o.qty),o.price=tribe.tickets.block.getPrice(s),e.updateItemTotal(o.qty,o.price,s),t(e.selectors.metaContainer+'[data-ticket-id="'+o.id+'"]').removeClass(e.selectors.metaContainerHasTickets.className()).find(e.selectors.metaItem).remove(),window.setTimeout(e.maybeShowNonMetaNotice,500,c),window.setTimeout((function(){const i=c.find(tribe.tickets.block.selectors.item).filter(":visible");if(tribe.tickets.block.updateFormTotals(c),e.maybeShowNonMetaNotice(c),0>=i.length){const e=t(tribe.tickets.block.selectors.blockSubmit).attr("data-content"),i="dialog_obj_"+e.substring(e.lastIndexOf("-")+1);window[i].hide(),tribe.tickets.utils.disable(t(tribe.tickets.block.selectors.submit),!1)}}),500)}))},e.updateItem=function(i,o,c){const s={};if(s.id=i,c){s.qty=tribe.tickets.block.getQty(c),s.price=tribe.tickets.block.getPrice(o),o.find(tribe.tickets.block.selectors.itemQuantityInput).val(s.qty).trigger("change");const e=tribe.tickets.block.selectors.itemOptOutInput+c.data("ticket-id"),i=tribe.tickets.block.selectors.itemOptOutInput+c.data("ticket-id")+"--modal";s.$optOut=t(e);const n=t(i);s.$optOut.length&&s.$optOut.is(":checked")?n.val("1").prop("checked",!0):n.val("0").prop("checked",!1)}else s.qty=tribe.tickets.block.getQty(o),s.price=tribe.tickets.block.getPrice(o);return e.updateItemTotal(s.qty,s.price,o),s},e.updateItemTotal=function(t,i,o){const c=o.closest("form"),s=tribe.tickets.block.getTicketsBlockProvider(c),n=tribe.tickets.utils.getCurrencyFormatting(s),r=(t*i).toFixed(n.number_of_decimals);return o.find(e.selectors.itemTotal).text(tribe.tickets.utils.numberFormat(r,s)),r},e.initPreFill=function(t){e.preFillTicketsBlock(t)},e.bindAfterUpdateFormTotals=function(t,i){e.appendARFields(i)},e.bindModalQuantityChange=function(t,i){if(i.closest(e.selectors.cartForm).length){const t=i.closest(tribe.tickets.block.selectors.item);e.updateItemTotal(tribe.tickets.block.getQty(t),tribe.tickets.block.getPrice(t),t)}},e.bindBeforeTicketsSubmit=function(t,e,i){e.find("#tribe_tickets_block_ar_data").val(JSON.stringify(i))},e.bindModalClose=function(){t(tribe.dialogs.events).on("tribe_dialog_close_ar_modal",(function(i,o){const c=t(o),s=c.find(e.selectors.form),n=s.data("post-id"),r=c.find(e.selectors.cartForm);tribe.tickets.data.storeLocal(n),tribe.tickets.block.unbindTicketsAddRemove(r),tribe.tickets.block.unbindTicketsQuantityInput(r),tribe.tickets.block.unbindDescriptionToggle(r),e.unbindOptOutChange(s),e.unbindModalSubmit(s),e.unbindModalItemRemove(s),e.unbindModalFormClick(s)}))},e.bindModalOpen=function(){t(tribe.dialogs.events).on("tribe_dialog_show_ar_modal",(function(o,c){const s=t(c),n=s.find(e.selectors.form),r=s.find(e.selectors.cartForm),a=i.find(tribe.tickets.block.selectors.form).filter('[data-post-id="'+n.data("postId")+'"]').find(tribe.tickets.block.selectors.item);tribe.tickets.loader.show(n),a.each((function(){const i=t(this),o=i.data("ticket-id"),c=r.find('[data-ticket-id="'+o+'"]');0!==c.length&&0!==i.length&&e.updateItem(o,c,i)})),tribe.tickets.block.bindTicketsAddRemove(r),tribe.tickets.block.bindTicketsQuantityInput(r),tribe.tickets.block.bindDescriptionToggle(r),e.bindModalSubmit(n),e.bindModalItemRemove(n),e.initModalFormPreFills(n),tribe.tickets.block.updateFormTotals(r),e.bindOptOutChange(n),e.bindModalFormClick(n),tribe.tickets.loader.hide(n)}))},e.bindAfterSetupTicketsBlock=function(t,i){TribeTicketOptions.ajax_preload_ticket_form&&(tribe.tickets.loader.show(i),e.initPreFill(i))},e.maybeSubmitBlockIfNoArTicketInCart=function(){TribeTicketsModal.ShowIfNoTicketWithArInCart||i.find(tribe.tickets.block.selectors.blockSubmit).on("click",(function(){const e=t(this),i=t(this).closest("form"),o=i.find(tribe.tickets.block.selectors.item),c=e.data("js").replace("trigger-dialog-","");let s=0;if(o.each((function(){const e=t(this);if(!e.is(":visible"))return;const i=tribe.tickets.block.getQty(e);e.data("ticket-ar-fields")&&0<i&&s++})),!s){let t;tribe.dialogs.dialogs.forEach((function(e,i){e.id===c&&(t=i)})),isNaN(t)||tribe.dialogs.dialogs[t].a11yInstance.destroy(),tribe.tickets.block.ticketsSubmit(i)}}))},e.bindOptOutChange=function(e){e.find("[id^=tribe-tickets-attendees-list-optout-]").change((function(){const e=t(this),i=e.attr("id"),o=t("#"+e.attr("id").substr(0,i.indexOf("--")));e.is(":checked")?o.val("1").prop("checked",!0):o.val("0").prop("checked",!1)}))},e.unbindOptOutChange=function(t){t.find("[id^=tribe-tickets-attendees-list-optout-]").unbind("change")},e.ready=function(){i.on("afterUpdateFormTotals.tribeTicketsBlock",e.bindAfterUpdateFormTotals),i.on("afterTicketsAddRemove.tribeTicketsBlock",e.bindModalQuantityChange),i.on("afterTicketsQuantityChange.tribeTicketsBlock",e.bindModalQuantityChange),i.on("beforeTicketsSubmit.tribeTicketsBlock",e.bindBeforeTicketsSubmit),i.on("afterSetup.tribeTicketsBlock",e.bindAfterSetupTicketsBlock),e.maybeSubmitBlockIfNoArTicketInCart(),e.bindModalOpen(),e.bindModalClose(),e.bindDocumentKeypress()},t(e.ready)}(jQuery,tribe.tickets.modal),window.ticketsPlus=window.ticketsPlus||{},window.ticketsPlus.v2=window.ticketsPlus.v2||{},window.ticketsPlus.v2.ticketsModal={};