!function(e,t){"use strict";window.tecTicketsPlusPresets=window.tecTicketsPlusPresets||{};const i=window.tecTicketsPlusPresets;t.selectors={costField:".tec-tickets-plus-preset__cost-field",capacityType:"#preset-capacity-type",capacityAmount:"#preset-capacity-amount",addField:".add-attendee-field",attendeeForm:"tribe-tickets-attendee-info-form",deleteField:".delete-attendee-field",fieldAccordion:".tribe-tickets-attendee-info-active-field",fieldAccordionContent:".tribe-tickets-attendee-info-field-options",fieldAccordionHeader:".tribe-tickets-attendee-info-field-title",fieldsetSaved:".tribe-tickets__admin-attendees-saved-fields",fieldsetSavedHasIac:".tribe-tickets__admin-attendees-saved-fields--has-iac",hidden:"tribe-common-a11y-hidden",iacAllowedCheckbox:"#ticket_iac_setting_allowed",iacContainer:".tribe-tickets-iac-container",iacFields:"#preset_attendee_collection_fields",iacFieldsContainer:"#tribe-tickets-attendee-sortables",iacFieldset:"#preset-iac-fieldset",iacMockedFields:".tribe-tickets__admin-attendees-info-iac-fields",iacMockedFieldsLabelRequired:".tribe-tickets__admin-attendee-info-field-title-label--required",iacNoneCheckbox:"#ticket_iac_setting_none",iacNotice:".tribe-tickets__admin-attendees-info-iac-notice",iacRadio:'input[name="preset[iac]"]',iacRequiredCheckbox:"#ticket_iac_setting_required",iacSetting:".tribe-tickets-iac-setting",savedFieldsContainer:".tribe-tickets-attendee-saved-fields",savedFieldsInput:"#saved_ticket-attendee-info",form:"#tec-tickets-plus-preset-form"},t.validateCostField=function(t){const i=e(t.target);let s=i.val();s=s.replace(/[^\d.]/g,"");const c=s.split(".");c.length>2&&(s=c[0]+"."+c.slice(1).join("")),i.val(s)},t.toggleCapacityAmount=function(){const i=e(t.selectors.capacityType),s=e(t.selectors.capacityAmount),c=s.parent();"unlimited"===i.val()?(c.addClass(t.selectors.hidden),s.prop("required",!1),s.prop("min",0)):(c.removeClass(t.selectors.hidden),s.prop("required",!0),s.prop("min",1))},t.setupAttendeeCollection=function(){e(document).on("change",t.selectors.iacRadio,(function(){const i=e(this).val(),s=e(t.selectors.iacFields),c=e(t.selectors.iacFieldset);"none"===i?(s.addClass("tribe-hidden"),c.prop("required",!1)):(s.removeClass("tribe-hidden"),c.prop("required",!0))}));const i=e(t.selectors.iacRadio+":checked");i.length&&"none"!==i.val()&&(e(t.selectors.iacFields).removeClass("tribe-hidden"),e(t.selectors.iacFieldset).prop("required",!0))},t.settingChange=function(i){const s=e(t.selectors.iacSetting),c=e(t.selectors.iacFieldsContainer);"none"!==s.val()||c.length?c.show():c.hide()},t.injectSavedFields=function(s){const c=e(s.target).val();if(!c)return;const d=e(t.selectors.iacFieldsContainer),o=i.nonce||"";e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"tec-tickets-plus-presets-load-saved-fields",nonce:o,fieldset_id:c},success:function(i){i.success&&i.data&&i.data.html&&(d.append(i.data.html),d.show(),t.maybeHideSavedFieldsSelect(),e(document).trigger("tribe_tickets_plus_iac_fields_injected",[d]))},error:function(t,i,s){e(document).trigger("event-tickets-plus-fieldset-load-failure.tribe",{fieldset_id:savedFieldsetId})}})},t.addField=function(s){s.preventDefault();const c=e(this).data("type");c&&e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"tribe-tickets-info-render-field",type:c,nonce:i.nonce},success:function(i){i.success&&e(t.selectors.iacFieldsContainer).length&&(e(document.getElementById("tribe-tickets-attendee-sortables")).append(i.data),t.maybeHideSavedFieldsSelect(),e(document).trigger("tribe_tickets_plus_field_added",[c]))},error:function(t,i,s){e(document).trigger("event-tickets-plus-fieldset-add-field-failure.tribe",{fieldset_id:savedFieldsetId})}})},t.hideSavedFieldsDropdown=function(){e(t.selectors.savedFieldsContainer).hide()},t.deleteField=function(i){i.preventDefault();const s=e(this).closest(t.selectors.fieldAccordion);s.length&&(s.remove(),e(document).trigger("tribe_tickets_plus_field_deleted"))},t.maybeHideSavedFieldsSelect=function(){e(".tribe-tickets__admin-attendee-info-field--active").length?e(t.selectors.fieldsetSaved).hide():e(t.selectors.fieldsetSaved).show()},t.maybeShowIacMockedFields=function(){const i=e(t.selectors.iacAllowedCheckbox).is(":checked"),s=e(t.selectors.iacRequiredCheckbox).is(":checked");i||s?t.showIacMockedFields():t.hideIacMockedFields()},t.handleIacCheckbox=function(e){e.preventDefault(),t.maybeShowIacMockedFields()},t.hideIacMockedFields=function(){const i=e(t.selectors.iacNotice),s=e(t.selectors.iacMockedFields),c=e(t.selectors.fieldsetSaved),d=t.selectors.hidden.className();i.addClass(d),s.addClass(d),c.removeClass(t.selectors.fieldsetSavedHasIac)},t.showIacMockedFields=function(){const i=e(t.selectors.iacMockedFields),s=e(t.selectors.iacNotice),c=i.find(t.selectors.iacMockedFieldsLabelRequired),d=e(t.selectors.fieldsetSaved),o=e(t.selectors.iacRequiredCheckbox).is(":checked"),n=t.selectors.hidden.className();s.removeClass(n),i.removeClass(n),o?c.removeClass(n):c.addClass(n),d.addClass(t.selectors.fieldsetSavedHasIac.className())},t.initCustomFieldSorting=function(){e(document.getElementById("tribe-tickets-attendee-sortables")).sortable({containment:"parent",items:".tribe-tickets__admin-attendee-info-field",handle:".hndle",tolerance:"pointer",connectWith:"#tribe-tickets-attendee-sortables"})},t.clickPostbox=function(){t.toggle_postbox(e(this).closest(".meta-postbox"))},t.toggle_postbox=function(e){e.toggleClass("closed")},t.toggleLinkedForm=function(){const t=e(document.getElementById("save_attendee_fieldset"));let i=e();const s=t.data("tribe-toggle");s&&(i=e(document.getElementById(s))),t.is(":checked")?i.show():i.hide()},t.initSalePeriodFields=function(){e(t.selectors.form).find(".tec-tickets-plus-preset__sale-type-select").on("change",(function(){const i=e(this).closest(".tec-tickets-plus-preset__sale-date").find(".tec-tickets-plus-preset__sale-relative");"relative"===e(this).val()?i.removeClass(t.selectors.hidden):i.addClass(t.selectors.hidden)})).trigger("change")},t.init=function(){t.initSalePeriodFields(),e(t.selectors.capacityType).on("change",t.toggleCapacityAmount),t.toggleCapacityAmount(),e(t.selectors.costField).on("input",t.validateCostField),t.setupAttendeeCollection(),t.initCustomFieldSorting(),t.maybeHideSavedFieldsSelect(),t.maybeShowIacMockedFields(),e(t.selectors.iacSetting).on("change",t.handleIacCheckbox),t.settingChange(),e(t.selectors.savedFieldsInput).on("change",t.injectSavedFields),e(document).on("click",".meta-postbox .hndle, .meta-postbox .handlediv",t.clickPostbox),e(document).on("click",t.selectors.addField,t.addField).on("click",t.selectors.deleteField,t.deleteField).on("change","input.show_attendee_info",t.toggleLinkedForm).on("change",".save_attendee_fieldset",t.toggleLinkedForm)},e(t.init)}(jQuery,{}),window.ticketsPlus=window.ticketsPlus||{},window.ticketsPlus.presets=window.ticketsPlus.presets||{},window.ticketsPlus.presets.tecTicketsPlusPresetsForm={};