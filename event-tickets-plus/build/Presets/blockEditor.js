(()=>{"use strict";var e,t={247:()=>{const e=window.wp.data,t={presets:window.tec.tickets_plus.presets.items||[]||[],defaultForm:null,metaFields:{},ticketsUsingPresets:{}},s=(0,e.createReduxStore)("tec-tickets-plus-presets",{reducer(e=t,s){switch(s.type){case"SET_PRESETS":return{...e,presets:s.presets};case"SET_DEFAULT_FORM":return{...e,defaultForm:s.defaultForm};case"SET_META_FIELDS":return{...e,metaFields:{...e.metaFields,[s.clientId]:s.metaFields}};case"SET_TICKET_USING_PRESET":return{...e,ticketsUsingPresets:{...e.ticketsUsingPresets,[s.clientId]:s.isUsing}};default:return e}},actions:{setPresets:e=>({type:"SET_PRESETS",presets:e}),setDefaultForm:e=>({type:"SET_DEFAULT_FORM",defaultForm:e}),setMetaFields:(e,t)=>({type:"SET_META_FIELDS",clientId:e,metaFields:t}),setTicketUsingPreset:(e,t)=>({type:"SET_TICKET_USING_PRESET",clientId:e,isUsing:t})},selectors:{getPresets:e=>e.presets,getDefaultForm:e=>e.defaultForm,getMetaFields:(e,t)=>e.metaFields[t],isTicketUsingPreset:(e,t)=>!!e.ticketsUsingPresets?.[t]},controls:{}});(0,e.register)(s);const i=window.wp.hooks,r=window.React,n=window.wp.i18n,c=tec.common.app.main.elements,a=window.ReactJSXRuntime,o=({options:e,selectedPreset:t,onPresetChange:s,onShowDefaultForm:i})=>(0,a.jsxs)("div",{className:"tribe-editor__ticket__preset tribe-editor__ticket__content-row tribe-editor__ticket__content-row--preset",children:[(0,a.jsx)(c.LabeledItem,{className:"tribe-editor__ticket__preset-label",label:(0,n.__)("Ticket Preset","event-tickets-plus")}),(0,a.jsxs)("div",{className:"tribe-editor__ticket__preset-select-wrapper",children:[(0,a.jsx)(c.Select,{className:"tribe-editor__preset-select",value:e.find((e=>e.value===t))||e[0],options:e,onChange:s}),(0,a.jsxs)("div",{className:"tribe-editor__preset-select__regular-ticket",children:[(0,n.__)("or","event-tickets-plus"),(0,a.jsx)("a",{href:"#",onClick:i,className:"tribe-editor__preset-select__regular-ticket-link",children:(0,n.__)("Create a new ticket for this event","event-tickets-plus")})]})]})]}),l=({isDisabled:e,onCancel:t,onAdd:s,reviewTicket:i})=>(0,a.jsx)("section",{className:"tribe-editor__action-dashboard tribe-editor__ticket__dashboard tribe-common",children:(0,a.jsxs)("div",{className:"tribe-editor__action-dashboard__group-right",children:[(0,a.jsx)("a",{className:"tribe-editor__button tribe-editor__action-dashboard__cancel-button",href:"#",onClick:e=>{e.preventDefault(),t()},children:(0,n.__)("Cancel","event-tickets-plus")}),!e&&(0,a.jsx)("a",{className:"tribe-editor__button tribe-editor__action-dashboard__review-button",href:"#",onClick:e=>{e.preventDefault(),i()},children:(0,n.__)("Review Ticket","event-tickets-plus")}),(0,a.jsx)(c.Button,{className:"tribe-editor__button tribe-editor__action-dashboard__confirm-button tribe-editor__button--sm tribe-common-c-btn",disabled:e,onClick:s,children:(0,n.__)("Add Ticket","event-tickets-plus")})]})}),d=tec.common.app.main.utils,_=e=>{try{const t=tec.events.app.main.data.getStore().getState(),s=tec.events.app.main.data.blocks.datetime.selectors,i="end"===e?s.getEnd(t):s.getStart(t);return i?d.moment.toMoment(i):d.moment.toMoment()}catch(e){return d.moment.toMoment()}},p=e=>{const t=d.moment.toMoment();return"end"===e?t.clone().add(24,"hours"):t},m=(e,t)=>{const{relative_to:s="post_date",direction:i="before",period:r="days",length:n=0,type:c="start"}=e,a=t?d.moment.toMoment(t):(e=>{if("published"===e.type)return d.moment.toMoment();const t=tribe.tickets.data.blocks.selectors.currentPostIsEvent();if("start"===e.type)return t?_("start"):p("start");if("relative"===e.type){const s="end"===e.relative_to?"end":"start";return t?_(s):p(s)}return d.moment.toMoment()})(e),o=a.clone();"after"===i?o.add(n,r):"before"===i&&o.subtract(n,r);const l=d.globals.tecDateSettings().datepickerFormat;return{moment:o,date:d.moment.toDatabaseDate(o),dateInput:l?d.moment.toDate(o,l):d.moment.toDate(o),time:d.moment.toDatabaseTime(o),timeInput:d.moment.toTime(o)}};function u({defaultForm:t,props:i}){const[c,d]=(0,r.useState)(!1),[_,p]=(0,r.useState)(""),{clientId:u,store:k}=i,b=(0,e.select)(s).getPresets()||[],h=()=>{const t=b.find((e=>String(e.id)===_));if(!t)return;const i=m(t.sale_start_logic),r=m(t.sale_end_logic),n=t.meta_fields;n.length>0&&((0,e.dispatch)(s).setMetaFields(u,n),k.dispatch(tribe.tickets.data.blocks.actions.setTicketHasAttendeeInfoFields(u,!0))),(0,e.dispatch)(s).setTicketUsingPreset(u,!0),k.dispatch(tribe.tickets.data.blocks.actions.setTicketTempDetails(u,{title:t.ticket_name,description:t.description,capacity:t.capacity.amount,capacityType:t.capacity.type,price:t.cost,startDate:i.date,startDateInput:i.dateInput,startDateMoment:i.moment,startTime:i.time,startTimeInput:i.timeInput,endDate:r.date,endDateInput:r.dateInput,endDateMoment:r.moment,endTime:r.time,endTimeInput:r.timeInput,iac:t?.iac_setting||"none"})),k.dispatch(tribe.tickets.data.blocks.actions.setTicketHasChanges(u,!0))},f=[{label:(0,n.__)("Select a preset...","event-tickets-plus"),value:""},...b.map((e=>({label:e?.name||(0,n.__)("Unnamed Preset","event-tickets-plus"),value:String(e?.id||"")})))];return c?t():(0,a.jsxs)("article",{className:"tribe-editor__ticket tribe-editor__ticket--selected",children:[(0,a.jsx)("div",{className:"tribe-editor__container-panel tribe-editor__container-panel--ticket tribe-editor__ticket__container",children:(0,a.jsx)("div",{className:"tribe-editor__container-panel__content ticket__preset__container",children:(0,a.jsx)(o,{options:f,selectedPreset:_,onPresetChange:e=>{p(e?.value||"")},onShowDefaultForm:e=>{e.preventDefault(),d(!0)}})})}),(0,a.jsx)(l,{isDisabled:!_,onCancel:()=>{k.dispatch(tribe.tickets.data.blocks.actions.removeTicketBlock(u)),(0,e.dispatch)("core/block-editor").removeBlocks(u),(0,e.dispatch)("core/block-editor").clearSelectedBlock()},onAdd:()=>{h(),k.dispatch(tribe.tickets.data.blocks.actions.createNewTicket(u)),(0,e.dispatch)("core/block-editor").clearSelectedBlock()},reviewTicket:()=>{h(),d(!0)}})]})}(0,i.addFilter)("tec.tickets.blocks.Ticket.renderSeatingForm","tec.tickets.plus.presets",((t,i)=>{const{clientId:r}=i,n=(0,e.select)(s).isTicketUsingPreset?.(r);return!n&&t}));const k=({metaFields:e})=>e&&e.length?(0,a.jsx)(r.Fragment,{children:e.map(((e,t)=>{const s="on"===e.required||!0===e.required;return(0,a.jsxs)(r.Fragment,{children:[t>0&&", ",(0,a.jsxs)("span",{className:"tec-tickets__attendee-field-label",children:[e.label,s&&(0,a.jsx)("span",{className:"tec-tickets__attendee-field-required",children:"*"})]})]},`field-${t}`)}))}):null;(0,i.addFilter)("tec.tickets.blocks.Ticket.form","tec.tickets.plus.presets",(function(t,i){return function(t){if(t.hasBeenCreated)return!1;if(0!==t.ticketId)return!1;if(0===((0,e.select)(s).getPresets()||[]).length)return!1;try{const e=tec.tickets.seating.blockEditorData;if(e.isUsingAssignedSeating&&e.isLayoutLocked)return!1}catch(e){}return!0}(i)?()=>function(e,t){return(0,a.jsx)("div",{className:"tec_tickets__editor__ticket-presets",children:(0,a.jsx)(u,{defaultForm:e,props:t})})}(t,i):t})),(0,i.addFilter)("tec.tickets.blocks.setBodyDetails","tec.tickets.plus.preset",(function(t,i){const r=(0,e.select)(s).getMetaFields(i);return r&&t.append("tribe-tickets-input",JSON.stringify(r)),t})),(0,i.addFilter)("tec.tickets.blocks.AttendeeRegistration.mappedProps","tec.tickets.plus.preset",(function(t,{state:i,ownProps:r}){let n=(0,e.select)(s).getMetaFields(r.clientId);return n||(n=tribe.tickets.data.blocks.selectors.getTicketAttendeeInfoFields(i,r)),n&&(t.fieldInfo=(0,a.jsx)(k,{metaFields:n})),t}))}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var n=s[e]={exports:{}};return t[e](n,n.exports,i),n.exports}i.m=t,e=[],i.O=(t,s,r,n)=>{if(!s){var c=1/0;for(d=0;d<e.length;d++){for(var[s,r,n]=e[d],a=!0,o=0;o<s.length;o++)(!1&n||c>=n)&&Object.keys(i.O).every((e=>i.O[e](s[o])))?s.splice(o--,1):(a=!1,n<c&&(c=n));if(a){e.splice(d--,1);var l=r();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,r,n]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={460:0,876:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var r,n,[c,a,o]=s,l=0;if(c.some((t=>0!==e[t]))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);if(o)var d=o(i)}for(t&&t(s);l<c.length;l++)n=c[l],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=globalThis.webpackChunkevent_tickets_plus=globalThis.webpackChunkevent_tickets_plus||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var r=i.O(void 0,[876],(()=>i(247)));r=i.O(r),window.ticketsPlus=window.ticketsPlus||{},window.ticketsPlus.presets=window.ticketsPlus.presets||{},window.ticketsPlus.presets.blockEditor=r})();