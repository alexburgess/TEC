(()=>{"use strict";var t,e={6:(t,e,i)=>{const s=window.wp.data,a="tec-tickets-plus.waitlist",l=window?.tec?.ticketsPlus?.waitlist.blockEditorData,{metaKeys:c}=l.localized,{subscribers:n}=l.localized,{tableUrl:r}=l.localized,o={...l},d=window.wp.hooks,k={hasTickets:(t,e)=>k.getTicketCount(t,e)>0,getTicketCount:(t,e)=>"tickets"===e?t?.ticketData?.count:t?.rsvpData?.count,getAvailability:(t,e)=>"tickets"===e?t?.availability?.tickets:t?.availability?.rsvp,hasAvailability:(t,e)=>Object.keys(k.getAvailability(t,e)).length>0,isWaitlistEnabled:(t,e)=>"tickets"===e?!!t?.waitlistData?.tickets?.enabled:!!t?.waitlistData?.rsvp?.enabled,getWaitlistConditional:(t,e)=>"tickets"===e?t?.waitlistData?.tickets?.conditional:t?.waitlistData?.rsvp?.conditional,getTicketsHaveNotStartedSales:(t,e)=>"tickets"===e?t?.ticketData?.ticketsHaveNotStartedSales||[]:t?.rsvpData?.ticketsHaveNotStartedSales||[],getTicketsOnSale:(t,e)=>"tickets"===e?t?.ticketData?.ticketsOnSale||[]:t?.rsvpData?.ticketsOnSale||[],getTicketsHaveEndedSales:(t,e)=>"tickets"===e?t?.ticketData?.ticketsHaveEndedSales||[]:t?.rsvpData?.ticketsHaveEndedSales||[],isUsingAssignedSeating:t=>!!t?.isUsingAssignedSeating,hasTicketsOnSale:(t,e)=>k.getTicketsOnSale(t,e).length>0,hasWaitlistEnded(t,e){if(!k.hasTickets(t,e))return!1;const i=k.getTicketsHaveEndedSales(t,e).length===k.getTicketCount(t,e);return(0,d.applyFilters)("tec.tickets-plus.waitlist.ended",i,e)},isWaitlistActive(t,e){if(!k.isWaitlistEnabled(t,e))return!1;if(!k.hasTickets(t,e))return!1;if(k.hasWaitlistEnded(t,e))return!1;if(k.hasTicketsOnSale(t,e))return!1;let i=!1;switch(k.getWaitlistConditional(t,e)){case c.conditionals.always:i=!0;break;case c.conditionals.before_sale:i=k.getTicketsHaveNotStartedSales(t,e).length===k.getTicketCount(t,e);break;case c.conditionals.on_sold_out:i=!k.hasAvailability(t,e)}return(0,d.applyFilters)("tec.tickets-plus.waitlist.active",i,e)}},p=window.moment;var u=i.n(p);function v(t){const{startDateMoment:e,endDateMoment:i,capacity:s}=t,a=t?.capacityType||"limited",l=u()();let c=!1,n=!1,r=!1;return e.isBefore(l)&&i.isAfter(l)&&(c=!0),e.isAfter(l)&&(n=!0),i.isBefore(l)&&(r=!0),{capacity:"unlimited"===a?-1:s,isOnSale:c,saleHasNotStarted:n,saleHasEnded:r}}const S={setUsingAssignedSeating:t=>({type:"SET_USING_ASSIGNED_SEATING",usingAssignedSeating:t}),reflectTicketChange:(t,e,i=!1)=>({type:"TICKET_CHANGED",ticketId:t,isCreate:i,...v(e)}),reflectTicketDeletion:t=>({type:"TICKET_DELETED",ticketId:t}),setWaitlistStatus:(t,e)=>({type:"WAITLIST_STATUS_CHANGED",enabled:t,blockType:e}),setWaitlistConditional:(t,e)=>({type:"WAITLIST_CONDITIONAL_CHANGED",conditional:t,blockType:e}),reflectRSVPChange:(t,e)=>({type:"RSVP_CHANGED",ticketId:t.id,isCreate:e,...v(t)}),reflectRSVPDeletion:t=>({type:"RSVP_DELETED",rsvpId:t})},h=(0,s.createReduxStore)(a,{reducer:function(t=o,e){const{ticketsOnSale:i,ticketsHaveNotStartedSales:s,ticketsHaveEndedSales:a}=t.ticketData,{ticketsOnSale:l,ticketsHaveNotStartedSales:c,ticketsHaveEndedSales:n}=t.rsvpData,{availability:r}=t;switch(e.type){case"SET_USING_ASSIGNED_SEATING":return{...t,isUsingAssignedSeating:!!e.usingAssignedSeating};case"WAITLIST_STATUS_CHANGED":return{...t,waitlistData:{...t.waitlistData,[e.blockType]:{...t.waitlistData[e.blockType],enabled:!!e.enabled}}};case"WAITLIST_CONDITIONAL_CHANGED":return{...t,waitlistData:{...t.waitlistData,[e.blockType]:{...t.waitlistData[e.blockType],conditional:e.conditional}}};case"TICKET_CHANGED":const o=e.isOnSale?[...i,e.ticketId]:i.filter((t=>t!==e.ticketId)),d=e.saleHasNotStarted?[...s,e.ticketId]:s.filter((t=>t!==e.ticketId)),k=e.saleHasEnded?[...a,e.ticketId]:a.filter((t=>t!==e.ticketId)),p=r.tickets[e.ticketId]||{available:e.capacity,sold:0};return p.available=e.capacity,-1!==e.capacity&&p.sold>=e.capacity?(delete r.tickets[e.ticketId],{...t,ticketData:{...t.ticketData,count:t.ticketData.count+(e.isCreate?1:0),ticketsOnSale:o,ticketsHaveNotStartedSales:d,ticketsHaveEndedSales:k},availability:r}):{...t,ticketData:{...t.ticketData,count:t.ticketData.count+(e.isCreate?1:0),ticketsOnSale:o,ticketsHaveNotStartedSales:d,ticketsHaveEndedSales:k},availability:{...t.availability,tickets:{...t.availability.tickets,[e.ticketId]:p}}};case"TICKET_DELETED":return delete r.tickets[e.ticketId],{...t,ticketData:{...t.ticketData,count:t.ticketData.count-1,ticketsOnSale:i.filter((t=>t!==e.ticketId)),ticketsHaveNotStartedSales:s.filter((t=>t!==e.ticketId)),ticketsHaveEndedSales:a.filter((t=>t!==e.ticketId))},availability:r};case"RSVP_DELETED":return delete r.rsvp[e.ticketId],{...t,rsvpData:{...t.rsvpData,count:t.rsvpData.count-1,ticketsOnSale:l.filter((t=>t!==e.ticketId)),ticketsHaveNotStartedSales:c.filter((t=>t!==e.ticketId)),ticketsHaveEndedSales:n.filter((t=>t!==e.ticketId))},availability:r};case"RSVP_CHANGED":const u=e.isOnSale?[...l,e.ticketId]:l.filter((t=>t!==e.ticketId)),v=e.saleHasNotStarted?[...c,e.ticketId]:c.filter((t=>t!==e.ticketId)),S=e.saleHasEnded?[...n,e.ticketId]:n.filter((t=>t!==e.ticketId)),h=r.rsvp[e.ticketId]||{available:e.capacity,sold:0};return h.available=e.capacity,-1!==e.capacity&&h.sold>=e.capacity?(delete r.rsvp[e.ticketId],{...t,rsvpData:{...t.rsvpData,count:t.rsvpData.count+(e.isCreate?1:0),ticketsOnSale:u,ticketsHaveNotStartedSales:v,ticketsHaveEndedSales:S},availability:r}):{...t,rsvpData:{...t.rsvpData,count:t.rsvpData.count+(e.isCreate?1:0),ticketsOnSale:u,ticketsHaveNotStartedSales:v,ticketsHaveEndedSales:S},availability:{...t.availability,rsvp:{...t.availability.rsvp,[e.ticketId]:h}}}}return t},actions:S,selectors:k});(0,s.register)(h);const w=window.React,b=window.wp.components,T=window.wp.i18n,g=window.wp.coreData,_=tec.common.app.main.data.editor,y=window.ReactJSXRuntime,E=(t,e)=>({label:{tickets:(0,T.__)("Notify people when tickets become available for your event.","event-tickets-plus"),rsvp:(0,T.__)("Notify people when RSVPs become available for your event.","event-tickets-plus")},alwaysLabel:{tickets:(0,T.__)("WHEN TICKETS ARE ON PRE-SALE OR SOLD OUT","event-tickets-plus"),rsvp:(0,T.__)("WHEN RSVP IS ON PRE-SALE OR AT MAXIMUM CAPACITY","event-tickets-plus")},beforeSaleLabel:{tickets:(0,T.__)("BEFORE TICKETS GO ON SALE","event-tickets-plus"),rsvp:(0,T.__)("BEFORE RSVP STARTS","event-tickets-plus")},onSoldOutLabel:{tickets:(0,T.__)("WHEN TICKETS ARE SOLD OUT","event-tickets-plus"),rsvp:(0,T.__)("WHEN RSVP REACHES MAXIMUM CAPACITY","event-tickets-plus")},alwaysDesc:{tickets:(0,T.__)("Shows before tickets go on sale and when tickets are sold out","event-tickets-plus"),rsvp:(0,T.__)("Shows before RSVP start date and after RSVP reaches maximum capacity","event-tickets-plus")},beforeSaleDesc:{tickets:(0,T.__)("Shows until tickets sale start date","event-tickets-plus"),rsvp:(0,T.__)("Shows until RSVP start date","event-tickets-plus")},onSoldOutDesc:{tickets:(0,T.__)("Shows when ticket capacity runs out","event-tickets-plus"),rsvp:(0,T.__)("Shows when RSVP capacity runs out","event-tickets-plus")},notice:{tickets:(0,T.__)("To create a waitlist you need to have existing tickets.","event-tickets-plus"),rsvp:(0,T.__)("To create a waitlist you need to have an existing RSVP.","event-tickets-plus")},ascNotice:{tickets:(0,T.__)("The waitlist functionality is not yet available in combination with Assigned Seating.","event-tickets-plus"),rsvp:(0,T.__)("The waitlist functionality is not yet available in combination with Assigned Seating.","event-tickets-plus")},waitlistActivePlural:{
// translators: 1) Opening a tag, 2) the number of registrants and 3) closing a tag.
tickets:(0,T.__)("The waitlist is currently active. There are %s%d registrants%s.","event-tickets-plus"),
// translators: 1) Opening a tag, 2) the number of registrants and 3) closing a tag.
rsvp:(0,T.__)("The waitlist is currently active. There are %s%d registrants%s.","event-tickets-plus")},waitlistActiveSingular:{
// translators: 1) Opening a tag, 2) the number of registrants and 3) closing a tag.
tickets:(0,T.__)("The waitlist is currently active. There is %s%d registrant%s.","event-tickets-plus"),
// translators: 1) Opening a tag, 2) the number of registrants and 3) closing a tag.
rsvp:(0,T.__)("The waitlist is currently active. There is %s%d registrant%s.","event-tickets-plus")},waitlistEndedPlural:{
// translators: 1) Opening a tag, 2) the number of registrants and 3) closing a tag.
tickets:(0,T.__)("This waitlist has ended. There are %s%d registrants%s.","event-tickets-plus"),
// translators: 1) Opening a tag, 2) the number of registrants and 3) closing a tag.
rsvp:(0,T.__)("This waitlist has ended. There are %s%d registrants%s.","event-tickets-plus")},waitlistEndedSingular:{
// translators: 1) Opening a tag, 2) the number of registrants and 3) closing a tag.
tickets:(0,T.__)("This waitlist has ended. There is %s%d registrant%s.","event-tickets-plus"),
// translators: 1) Opening a tag, 2) the number of registrants and 3) closing a tag.
rsvp:(0,T.__)("This waitlist has ended. There is %s%d registrant%s.","event-tickets-plus")}}[t][e]),f=({hasTickets:t,type:e})=>{if(!t)return(0,y.jsx)(b.PanelRow,{children:(0,y.jsx)(b.Notice,{status:"info",isDismissible:!1,children:E("notice",e)})})},D=({isUsingAssignedSeating:t,type:e})=>{if(t)return(0,y.jsx)(b.PanelRow,{children:(0,y.jsx)(b.Notice,{status:"info",isDismissible:!1,children:E("ascNotice",e)})})},A=({label:t,description:e})=>(0,y.jsxs)("div",{children:[(0,y.jsx)("strong",{children:t}),(0,y.jsx)("p",{children:e})]}),I=({hasEnded:t,type:e})=>{if(!t)return;const i=(1===n[e]?E("waitlistEndedSingular",e):E("waitlistEndedPlural",e)).split("%s");return(0,y.jsx)(b.PanelRow,{children:(0,y.jsxs)(b.Notice,{status:"info",isDismissible:!1,children:[i[0],(0,y.jsx)("a",{href:r,target:"_blank",rel:"noreferrer",children:(0,T.sprintf)(i[1],n[e])}),i[2]]})})},C=({type:t})=>{const e=(1===n[t]?E("waitlistActiveSingular",t):E("waitlistActivePlural",t)).split("%s");return(0,y.jsx)(b.PanelRow,{className:"tec-tickets-plus-waitlist__waitlist-active-notice",children:(0,y.jsxs)(b.Notice,{status:"info",isDismissible:!1,children:[e[0],(0,y.jsx)("a",{href:r,target:"_blank",rel:"noreferrer",children:(0,T.sprintf)(e[1],n[t])}),e[2]]})})},N=({children:t})=>(0,y.jsx)("div",{className:"tec-tickets-plus-waitlist__rsvp-notice-container",children:t}),O=(0,w.memo)((({type:t})=>{const{hasTickets:e,postType:i,postId:l,isWaitlistEnabled:n,selectedConditional:r,isUsingAssignedSeating:o,hasEnded:d}=(0,s.useSelect)((e=>({hasTickets:e(a).hasTickets(t),isWaitlistEnabled:e(a).isWaitlistEnabled(t),selectedConditional:e(a).getWaitlistConditional(t),postType:e("core/editor").getCurrentPostType(),postId:e("core/editor").getCurrentPostId(),isUsingAssignedSeating:e(a).isUsingAssignedSeating(),hasEnded:e(a).hasWaitlistEnded(t)}))),k=i===_.EVENT,{setWaitlistStatus:p,setWaitlistConditional:u}=(0,s.useDispatch)(a),[v,S]=(0,g.useEntityProp)("postType",i,"meta",l),h=n&&e&&!o;return(0,y.jsxs)(b.PanelBody,{title:(0,T.__)("Waitlist","event-tickets-plus"),className:"tec-tickets-plus-waitlist__panel-body",children:[(0,y.jsx)(b.PanelRow,{children:(0,y.jsx)("p",{children:E("label",t)})}),(0,y.jsx)(f,{hasTickets:e,type:t}),(0,y.jsx)(D,{isUsingAssignedSeating:o,type:t}),(0,y.jsx)(b.PanelRow,{children:(0,y.jsx)(b.ToggleControl,{label:(0,T.__)("Enable Waitlist","event-tickets-plus"),onChange:e=>{p(e,t);const i={...v,[c[t].enabled]:e?"1":"0",[c[t].conditional]:r};S(i)},disabled:!e||o,checked:h})}),h&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(b.PanelRow,{children:(0,y.jsx)("p",{children:(0,y.jsx)("strong",{children:(0,T.__)("SHOW","event-tickets-plus")})})}),(0,y.jsx)(b.PanelRow,{children:(0,y.jsx)(b.RadioControl,{help:k?(0,T.__)("The waitlist will no longer show after the start of the event.","event-tickets-plus"):"",selected:r||"always",options:[{label:(0,y.jsx)(A,{label:E("alwaysLabel",t),description:E("alwaysDesc",t)}),value:c.conditionals.always},{label:(0,y.jsx)(A,{label:E("beforeSaleLabel",t),description:E("beforeSaleDesc",t)}),value:c.conditionals.before_sale},{label:(0,y.jsx)(A,{label:E("onSoldOutLabel",t),description:E("onSoldOutDesc",t)}),value:c.conditionals.on_sold_out}],onChange:e=>{u(e,t);const i={...v,[c[t].conditional]:e};S(i)}})})]}),(0,y.jsx)(I,{hasEnded:d,type:t})]})})),H=t=>(0,s.select)(a).isWaitlistActive("tickets")?(t.push((0,y.jsx)(C,{type:"tickets"})),t):t;(0,d.addFilter)("tec.tickets.blocks.Tickets.Controls","tec.tickets-plus.waitlist",(t=>(t.push((0,y.jsx)(O,{type:"tickets"},"tickets")),t))),(0,d.addFilter)("tec.tickets.blocks.RSVP.Controls","tec.tickets-plus.waitlist",(t=>(t.push((0,y.jsx)(O,{type:"rsvp"},"rsvp")),t))),(0,d.addAction)("tec.tickets.blocks.rsvp.createdOrUpdated","tec.tickets-plus.waitlist",((t,e)=>{(0,s.dispatch)(a).reflectRSVPChange(t,e)})),(0,d.addAction)("tec.tickets.blocks.rsvp.deleted","tec.tickets-plus.waitlist",(t=>{(0,s.dispatch)(a).reflectRSVPDeletion(t)})),(0,d.addAction)("tec.tickets.blocks.ticketUpdated","tec.tickets-plus.waitlist",((t,e,i)=>{(0,s.dispatch)(a).reflectTicketChange(e,i)})),(0,d.addAction)("tec.tickets.blocks.ticketCreated","tec.tickets-plus.waitlist",((t,e,i)=>{(0,s.dispatch)(a).reflectTicketChange(e,i,!0)})),(0,d.addAction)("tec.tickets.blocks.ticketDeleted","tec.tickets-plus.waitlist",((t,e)=>{(0,s.dispatch)(a).reflectTicketDeletion(e)})),(0,d.addAction)("tec.tickets.seating.setUsingAssignedSeating","tec.tickets-plus.waitlist",(t=>{(0,s.dispatch)(a).setUsingAssignedSeating(t)})),(0,d.addFilter)("tec.tickets.blocks.Tickets.ComponentsBeforeHeader","tec.tickets-plus.waitlist",H),(0,d.addFilter)("tec.tickets.blocks.Tickets.ComponentsBeforeInactiveHeader","tec.tickets-plus.waitlist",H),(0,d.addFilter)("tec.tickets.blocks.RSVP.ComponentsBeforeHeader","tec.tickets-plus.waitlist",(t=>(0,s.select)(a).isWaitlistActive("rsvp")?(t.push((0,y.jsx)(N,{children:(0,y.jsx)(C,{type:"rsvp"})})),t):(t.push((0,y.jsx)(N,{})),t)))}},i={};function s(t){var a=i[t];if(void 0!==a)return a.exports;var l=i[t]={exports:{}};return e[t](l,l.exports,s),l.exports}s.m=e,t=[],s.O=(e,i,a,l)=>{if(!i){var c=1/0;for(d=0;d<t.length;d++){for(var[i,a,l]=t[d],n=!0,r=0;r<i.length;r++)(!1&l||c>=l)&&Object.keys(s.O).every((t=>s.O[t](i[r])))?i.splice(r--,1):(n=!1,l<c&&(c=l));if(n){t.splice(d--,1);var o=a();void 0!==o&&(e=o)}}return e}l=l||0;for(var d=t.length;d>0&&t[d-1][2]>l;d--)t[d]=t[d-1];t[d]=[i,a,l]},s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={385:0,909:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var a,l,[c,n,r]=i,o=0;if(c.some((e=>0!==t[e]))){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(r)var d=r(s)}for(e&&e(i);o<c.length;o++)l=c[o],s.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return s.O(d)},i=globalThis.webpackChunkevent_tickets_plus=globalThis.webpackChunkevent_tickets_plus||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var a=s.O(void 0,[909],(()=>s(6)));a=s.O(a),window.ticketsPlus=window.ticketsPlus||{},window.ticketsPlus.waitlist=window.ticketsPlus.waitlist||{},window.ticketsPlus.waitlist.blockEditor=a})();